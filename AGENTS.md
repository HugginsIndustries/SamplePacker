## Agent Operating Instructions

These rules apply to any automated assistant working in this repository. Follow them for every task unless explicitly overruled by the maintainer.

1. **Keep documentation current.** Whenever you change behavior, configuration, or user-facing flow, update both `README.md` and `docs/GUI_GUIDE.md` in the same change set. Cross-check acceptance criteria and examples so the docs match the new behaviour, and call out the doc updates explicitly in your final summary.
2. **Maintain code quality.** Use the project's established formatting tools and idioms. Prefer clear structure, descriptive naming, defensive programming, and add tests when behavior could regress.
3. **Maintain `TODO.md`.** Before starting work, read the entire `TODO.md`. When tasks touch roadmap items, update the relevant entries using the maintainer guide at the top (imperative phrasing, priority tags, acceptance bullets, summary counts). Do not mark items complete—remove them once finished—and confirm the summary counts still reflect reality before handing off.
4. **Ask when unsure.** If any requirement, scope, or detail is ambiguous, stop and request clarification before proceeding. Never make assumptions about desired behaviour or acceptance criteria; if the maintainer is unavailable, pause work and summarize open questions instead of guessing.
5. **Install dev tooling.** Before running project checks, install development dependencies. Locally, run `pip install -e ".[dev]"`. In cloud shells (e.g., Cursor sandbox), run `cd /workspace && sudo apt-get update && sudo apt-get install -y ffmpeg`, then `cd /workspace && pip install -e ".[dev]"`.
6. **Run relevant checks.** Before handing back changes, run these commands in order. Locally: `pytest -q`, `ruff check spectrosampler tests scripts --fix`, `mypy spectrosampler --ignore-missing-imports`, `black spectrosampler tests scripts`. In cloud shells, run `cd /workspace && python3 -m pytest -q`, `cd /workspace && python3 -m ruff check spectrosampler tests scripts --fix`, `cd /workspace && python3 -m mypy spectrosampler --ignore-missing-imports`, `cd /workspace && python3 -m black spectrosampler tests scripts`. Always run the full sequence; if any command fails, fix the issue and restart the sequence from the top before handing off.
7. **Prioritize current release.** The program is unreleased; skip backward compatibility. Optimize functionality and efficiency first, and when you make performance-oriented changes, provide a brief rationale or metric so the benefit is clear.
8. **Preserve user edits.** Leave any existing uncommitted changes untouched unless the maintainer explicitly instructs you to revert them. If you encounter unexpected workspace changes mid-task, pause and ask how to proceed instead of reverting or overwriting.
9. **Document in lockstep.** When behavior changes, update `README.md` and `docs/GUI_GUIDE.md` in the same commit and mention the cross-check in your summary.
10. **Explain changes.** In your final summary, provide a detailed account of what you changed, how you changed it, and why the change was necessary so reviewers fully understand the reasoning.

Compliance with these rules is mandatory for every contribution.